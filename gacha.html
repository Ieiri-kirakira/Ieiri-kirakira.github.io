<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ğŸ€ ãŠé¡Œã‚¬ãƒãƒ£</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family: "Noto Serif JP", serif;
  background:#fff0f7;
  margin:0;
  padding:20px;
}
h1{color:#d6007f}

.box{
  background:#fff;
  border:2px solid #ffb6d9;
  border-radius:12px;
  padding:15px;
  margin-bottom:20px;
}

textarea,input,button{
  width:100%;
  box-sizing:border-box;
  margin:5px 0;
  padding:8px;
  font-size:14px;
}

button{
  background:#ff7eb9;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
button:hover{opacity:.85}

#gachaList button{
  margin-bottom:6px;
}

.result-box {
  margin-top: 20px;
  padding: 25px;
  background: linear-gradient(135deg, #fff1f8, #fce4ec);
  border: 2px solid #e91e63;
  border-radius: 12px;
  font-size: 1.2em;
  line-height: 1.8;
  box-shadow: 0 0 20px rgba(233,30,99,0.3);
  animation: pop 0.4s ease;
  white-space: pre-wrap;
}

@keyframes pop {
  from { transform: scale(0.95); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}

.hidden{display:none}
</style>
</head>

<body>

<h1>ğŸ€ ãŠé¡Œã‚¬ãƒãƒ£</h1>

<div class="box">
  <h3>ğŸ‘¤ ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›</h3>
  <input id="name1" placeholder="name1">
  <input id="name2" placeholder="name2">
</div>

<div class="box">
  <h3>ğŸ° ã‚¬ãƒãƒ£ä¸€è¦§</h3>
  <div id="gachaList"></div>
</div>

<div class="box">
  <h3 id="currentGachaTitle">ã‚¬ãƒãƒ£ã‚’é¸ã‚“ã§ãã ã•ã„</h3>
  <button id="spinBtn" disabled>ã‚¬ãƒãƒ£ã‚’å›ã™</button>
  <div id="result" class="result-box"></div>
</div>

<hr>

<div class="box">
  <h3>ğŸ›  ç®¡ç†ç”»é¢</h3>

  <label>ã‚¬ãƒãƒ£IDï¼ˆè‹±æ•°å­—ãƒ»ä¸€æ„ï¼‰</label>
  <input id="gid" placeholder="example-gacha">

  <label>ã‚¿ã‚¤ãƒˆãƒ«</label>
  <input id="gtitle" placeholder="â—‹â—‹ã‚¬ãƒãƒ£">

  <label>èª¬æ˜</label>
  <textarea id="gdesc"></textarea>

  <label>ã‚¹ãƒ­ãƒƒãƒˆï¼ˆ1è¡Œï¼1ãƒã‚¿ï¼‰</label>
  <textarea id="gslots" rows="10"
placeholder="1. {name1}ã¨{name2}ãŒã€œ
2. â—‹â—‹ãª{name1}ã¯â€¦"></textarea>

  <button onclick="saveFromAdmin()">ğŸ’¾ ä¿å­˜</button>
</div>

<script type="module">
import { loadGachas, saveGacha } from "./firebase.js";

let gachas = [];
let current = null;

async function init(){
  gachas = await loadGachas();
  const list = document.getElementById("gachaList");
  list.innerHTML = "";

  gachas.forEach(g => {
    const btn = document.createElement("button");
    btn.textContent = g.title;
    btn.onclick = () => selectGacha(g);
    list.appendChild(btn);
  });
}

function selectGacha(g){
  current = g;
  document.getElementById("currentGachaTitle").textContent = g.title;
  document.getElementById("spinBtn").disabled = false;
}

document.getElementById("spinBtn").onclick = () => {
  if(!current || !current.slots.length){
    result.textContent = "ãŠé¡ŒãŒã‚ã‚Šã¾ã›ã‚“";
    return;
  }

  const n1 = name1.value || "";
  const n2 = name2.value || "";

  const text = current.slots[
    Math.floor(Math.random() * current.slots.length)
  ]
    .replaceAll("{name1}", n1)
    .replaceAll("{name2}", n2);

  result.textContent = text;
};

window.saveFromAdmin = async () => {
  const gacha = {
    id: gid.value,
    title: gtitle.value,
    description: gdesc.value,
    slots: gslots.value.split("\n").filter(v => v.trim())
  };

  await saveGacha(gacha);
  alert("ä¿å­˜ï¼†å³åæ˜ ã•ã‚Œã¾ã—ãŸ");
  init();
};

init();
</script>

</body>
</html>
