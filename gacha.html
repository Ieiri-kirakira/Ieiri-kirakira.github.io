<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒãƒ£ï½œã‚­ãƒ©ã‚­ãƒ©å‰µä½œäººç”Ÿ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:"Noto Serif JP",serif;
  background:#fff0f7;
  color:#a3005a;
}
h1,h2,h3{text-align:center;}
button{
  background:#ff7dbb;
  color:#fff;
  border:none;
  border-radius:999px;
  padding:10px 18px;
  font-size:15px;
  cursor:pointer;
}
button:hover{background:#ff5fa9;}
textarea,input,select{
  width:100%;
  box-sizing:border-box;
  border-radius:10px;
  border:1px solid #ffb6d9;
  padding:8px;
}
.tabs{
  display:flex;
  justify-content:center;
  gap:12px;
  margin:20px 0;
}
.tab-content{display:none;}
.tab-content.active{display:block;}

.card{
  background:#fff;
  border-radius:18px;
  padding:20px;
  margin:20px auto;
  max-width:520px;
  box-shadow:0 6px 18px rgba(255,120,180,.25);
  text-align:center;
}
.slot{font-size:20px;margin:10px 0;}
.count{font-size:13px;color:#888;margin-top:10px;}

@media(max-width:600px){
  .slot{font-size:18px;}
}
</style>
</head>

<body>

<h1>ğŸ€ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒãƒ£ ğŸ€</h1>

<div class="tabs">
  <button id="tab-play">ã‚¬ãƒãƒ£</button>
  <button id="tab-admin">ç®¡ç†</button>
</div>

<!-- ===== ã‚¬ãƒãƒ£ç”»é¢ ===== -->
<div id="play" class="tab-content active">
  <div class="card">
    <h2 id="gacha-title"></h2>

    <div id="slots"></div>

    <button onclick="rollGacha()">ã‚¬ãƒãƒ£ã‚’å›ã™</button>

    <div class="count">
      å›ã•ã‚ŒãŸå›æ•°ï¼š<span id="count">0</span>
    </div>
  </div>
</div>

<!-- ===== ç®¡ç†ç”»é¢ ===== -->
<div id="admin" class="tab-content">
  <div class="card">
    <h2>ç®¡ç†ç”»é¢</h2>

    <label>ã‚¬ãƒãƒ£é¸æŠ</label>
    <select id="gachaSelect" onchange="selectGacha()"></select>

    <hr>

    <label>ã‚¬ãƒãƒ£å</label>
    <input id="editTitle">

    <label>ã‚¹ãƒ­ãƒƒãƒˆæ•°</label>
    <select id="slotCount" onchange="renderSlotEditors()">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>

    <div id="slotEditors"></div>

    <button onclick="saveGacha()">ä¿å­˜</button>
    <button onclick="addGacha()">ï¼‹ æ–°ã—ã„ã‚¬ãƒãƒ£</button>
  </div>
</div>

<script>
/* ===== åŸºæœ¬ ===== */
function showTab(id){
  document.querySelectorAll(".tab-content")
    .forEach(el=>el.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
document.getElementById("tab-play").onclick=()=>showTab("play");

/* ===== ç®¡ç†ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ ===== */
const ADMIN_PASSWORD="IEIRI_ADMIN_405";
document.getElementById("tab-admin").onclick=()=>{
  const pw=prompt("ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
  if(pw===ADMIN_PASSWORD){showTab("admin");}
  else{alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");}
};

/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */
let data=JSON.parse(localStorage.getItem("gachaData"))||{
  current:0,
  gachas:[
    {
      title:"ã‚¤ãƒ³ã‚¹ãƒ”ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒãƒ£",
      slots:[
        ["å¹¼é¦´æŸ“","å¹´ä¸Š","ãƒ©ã‚¤ãƒãƒ«"],
        ["æ”¾èª²å¾Œ","é›¨ã®æ—¥","å¤¢ã®ä¸­"],
        ["å‘Šç™½","å†ä¼š","è¡æ’ƒã®çœŸå®Ÿ"]
      ],
      count:0
    }
  ]
};
save();

/* ===== è¡¨ç¤º ===== */
function renderPlay(){
  const g=data.gachas[data.current];
  document.getElementById("gacha-title").textContent=g.title;
  document.getElementById("count").textContent=g.count;

  const s=document.getElementById("slots");
  s.innerHTML="";
  g.slots.forEach(()=> {
    const d=document.createElement("div");
    d.className="slot";
    d.textContent="â€•";
    s.appendChild(d);
  });
}

function rollGacha(){
  const g=data.gachas[data.current];
  document.querySelectorAll(".slot").forEach((el,i)=>{
    const list=g.slots[i];
    el.textContent=list[Math.floor(Math.random()*list.length)];
  });
  g.count++;
  save();
  renderPlay();
}

/* ===== ç®¡ç† ===== */
function renderAdmin(){
  const sel=document.getElementById("gachaSelect");
  sel.innerHTML="";
  data.gachas.forEach((g,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.textContent=g.title;
    sel.appendChild(o);
  });
  sel.value=data.current;
  loadEditor();
}

function selectGacha(){
  data.current=Number(document.getElementById("gachaSelect").value);
  save();
  loadEditor();
  renderPlay();
}

function loadEditor(){
  const g=data.gachas[data.current];
  document.getElementById("editTitle").value=g.title;
  document.getElementById("slotCount").value=g.slots.length;
  renderSlotEditors();
}

function renderSlotEditors(){
  const g=data.gachas[data.current];
  const c=document.getElementById("slotEditors");
  c.innerHTML="";
  const n=Number(document.getElementById("slotCount").value);
  g.slots.length=n;

  for(let i=0;i<n;i++){
    if(!g.slots[i]) g.slots[i]=[];
    const ta=document.createElement("textarea");
    ta.value=g.slots[i].join("\n");
    ta.oninput=()=>g.slots[i]=ta.value.split("\n").filter(Boolean);
    c.appendChild(document.createTextNode(`ã‚¹ãƒ­ãƒƒãƒˆ${i+1}`));
    c.appendChild(ta);
  }
}

function saveGacha(){
  const g=data.gachas[data.current];
  g.title=document.getElementById("editTitle").value;
  save();
  renderAdmin();
  renderPlay();
}

function addGacha(){
  data.gachas.push({
    title:"æ–°ã—ã„ã‚¬ãƒãƒ£",
    slots:[[]],
    count:0
  });
  data.current=data.gachas.length-1;
  save();
  renderAdmin();
  renderPlay();
}

function save(){
  localStorage.setItem("gachaData",JSON.stringify(data));
}

/* ===== åˆæœŸæç”» ===== */
renderPlay();
renderAdmin();
</script>

</body>
</html>
