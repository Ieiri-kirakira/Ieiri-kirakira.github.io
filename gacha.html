<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ãŠé¡Œã‚¬ãƒãƒ£</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family: "Noto Serif JP", serif;
  background:#fff0f7;
  margin:0;
  padding:20px;
}
h1{color:#d6007f}
.box{
  background:#fff;
  border:2px solid #ffb6d9;
  border-radius:12px;
  padding:15px;
  margin-bottom:20px;
}
textarea,input,button{
  width:100%;
  box-sizing:border-box;
  margin:5px 0;
  padding:8px;
  font-size:14px;
}
button{
  background:#ff7eb9;
  color:#fff;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
button:hover{opacity:.85}
.result{
  white-space:pre-wrap;
  line-height:1.8;
  font-size:15px;
}
.hidden{display:none}
  .result-box {
  margin-top: 30px;
  padding: 25px;
  background: linear-gradient(135deg, #fff1f8, #fce4ec);
  border: 2px solid #e91e63;
  border-radius: 12px;
  font-size: 1.2em;
  line-height: 1.8;
  box-shadow: 0 0 20px rgba(233,30,99,0.3);
  animation: pop 0.4s ease;
}

@keyframes pop {
  from { transform: scale(0.95); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}

</style>
</head>

<body>

<h1>ğŸ€ ãŠé¡Œã‚¬ãƒãƒ£</h1>

<div class="box">
  <h3>ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›</h3>
  <input id="name1" placeholder="name1ï¼ˆä»»æ„ï¼‰">
  <input id="name2" placeholder="name2ï¼ˆä»»æ„ï¼‰">
  <button onclick="rollGacha()">ã‚¬ãƒãƒ£ã‚’å›ã™</button>
</div>

<div class="box">
  <h3>çµæœ</h3>
  <div id="result" class="result-box"></div>


<hr>

<div class="box">
  <h3>ğŸ”’ ç®¡ç†ç”»é¢</h3>
  <button onclick="enterAdmin()">ç®¡ç†ãƒ¢ãƒ¼ãƒ‰ã«å…¥ã‚‹</button>

  <div id="admin" class="hidden">
    <p>â€» 1è¡Œ = 1å€™è£œï¼ˆç•ªå·OKï¼‰</p>
    <textarea id="slotText" rows="15"></textarea>
    <button onclick="saveGacha()">ä¿å­˜</button>
    <p id="adminMsg"></p>
  </div>
</div>

<script>
/* ======================
   ãƒ‡ãƒ¼ã‚¿åˆæœŸåŒ–
====================== */
const STORAGE_KEY = "simpleGacha_v1";
let gacha = {
  slots: []
};

function load(){
  const d = localStorage.getItem(STORAGE_KEY);
  if(d){
    gacha = JSON.parse(d);
  }
}
function save(){
  localStorage.setItem(STORAGE_KEY, JSON.stringify(gacha));
}

/* ======================
   ç®¡ç†ç”»é¢
====================== */
function enterAdmin(){
  const pw = prompt("ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰");
  if(pw !== "IEIRI_ADMIN_405"){
    alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
    return;
  }
  document.getElementById("admin").classList.remove("hidden");
  document.getElementById("slotText").value = gacha.slots.join("\n");
}

function saveGacha(){
  const raw = document.getElementById("slotText").value;

  gacha.slots = raw
    .split("\n")
    .map(v => v.trim())
    .filter(v => v.length > 0);

  save();
  document.getElementById("adminMsg").textContent =
    `ä¿å­˜ã—ã¾ã—ãŸï¼ˆ${gacha.slots.length}ä»¶ï¼‰`;
}

/* ======================
   ã‚¬ãƒãƒ£å®Ÿè¡Œ
====================== */
function rollGacha(){
  if(!gacha.slots.length){
    document.getElementById("result").textContent = "ãŠé¡ŒãŒç™»éŒ²ã•ã‚Œã¦ã„ã¾ã›ã‚“";
    return;
  }

  const n1 = document.getElementById("name1").value || "";
  const n2 = document.getElementById("name2").value || "";

  const text = gacha.slots[
    Math.floor(Math.random() * gacha.slots.length)
  ]
  .replaceAll("{name1}", n1)
  .replaceAll("{name2}", n2);

  document.getElementById("result").textContent = text;
}

/* ======================
   èµ·å‹•æ™‚
====================== */
load();
</script>
  <script src="gacha-data.js"></script>
<script src="gacha-common.js"></script>
<div id="result" class="result-box"></div>

  <script type="module">
import { loadGachas, saveGacha } from "./firebase.js";

const params = new URLSearchParams(location.search);
const gachaId = params.get("id");

/* å›ã™å´ */
if (gachaId) {
  const gachas = await loadGachas();
  const g = gachas.find(v => v.id === gachaId);

  window.spin = () => {
    const text =
      g.slots[Math.floor(Math.random() * g.slots.length)]
        .replaceAll("{name1}", name1.value)
        .replaceAll("{name2}", name2.value);

    result.textContent = text;
  };
}

/* ç®¡ç†å´ï¼šä¿å­˜ */
window.saveFromAdmin = async () => {
  const gacha = {
    id: document.getElementById("gid").value,
    title: document.getElementById("gtitle").value,
    description: document.getElementById("gdesc").value,
    slots: document.getElementById("gslots")
      .value.split("\n").filter(v => v.trim())
  };

  await saveGacha(gacha);
  alert("ä¿å­˜ï¼†å³åæ˜ ã•ã‚Œã¾ã—ãŸ");
};
</script>


</body>
</html>

