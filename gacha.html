<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒãƒ£ï½œã‚­ãƒ©ã‚­ãƒ©å‰µä½œäººç”Ÿ</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:"Noto Serif JP",serif;
  background:#fff0f7;
  color:#a3005a;
}
h1,h2{text-align:center;}
button{
  background:#ff7dbb;
  color:#fff;
  border:none;
  border-radius:999px;
  padding:10px 18px;
  font-size:15px;
  cursor:pointer;
}
button:hover{background:#ff5fa9;}
input,textarea,select{
  width:100%;
  box-sizing:border-box;
  padding:8px;
  border-radius:10px;
  border:1px solid #ffb6d9;
  margin-bottom:10px;
}
.tabs{
  display:flex;
  justify-content:center;
  gap:12px;
  margin:20px 0;
}
.tab-content{display:none;}
.tab-content.active{display:block;}
.card{
  background:#fff;
  border-radius:18px;
  padding:20px;
  margin:20px auto;
  max-width:520px;
  box-shadow:0 6px 18px rgba(255,120,180,.25);
  text-align:center;
}
.slot{font-size:20px;margin:10px 0;}
.count{font-size:13px;color:#888;margin-top:10px;}
@media(max-width:600px){
  .slot{font-size:18px;}
}
</style>
</head>

<body>

<h1>ğŸ€ ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¬ãƒãƒ£ ğŸ€</h1>

<div class="tabs">
  <button id="tab-play">ã‚¬ãƒãƒ£</button>
  <button id="tab-admin">ç®¡ç†</button>
</div>

<!-- ===== ã‚¬ãƒãƒ£ç”»é¢ ===== -->
<div id="play" class="tab-content active">
  <div class="card">
    <h2 id="gacha-title"></h2>

    <div id="user-inputs"></div>

    <div id="slots"></div>

    <button onclick="rollGacha()">ã‚¬ãƒãƒ£ã‚’å›ã™</button>

    <div class="count">
      å›ã•ã‚ŒãŸå›æ•°ï¼š<span id="count">0</span>
    </div>
  </div>
</div>

<!-- ===== ç®¡ç†ç”»é¢ ===== -->
<div id="admin" class="tab-content">
  <div class="card">
    <h2>ç®¡ç†ç”»é¢</h2>

    <label>ã‚¬ãƒãƒ£é¸æŠ</label>
    <select id="gachaSelect" onchange="selectGacha()"></select>

    <label>ã‚¬ãƒãƒ£å</label>
    <input id="editTitle">

    <label>å…¥åŠ›æ¬„ã®æ•°</label>
    <select id="inputCount">
      <option value="0">0</option>
      <option value="1">1</option>
      <option value="2">2</option>
    </select>

    <label>ã‚¹ãƒ­ãƒƒãƒˆæ•°</label>
    <select id="slotCount" onchange="renderSlotEditors()">
      <option value="1">1</option>
      <option value="2">2</option>
      <option value="3">3</option>
    </select>

    <div id="slotEditors"></div>

    <button onclick="saveGacha()">ä¿å­˜</button>
    <button onclick="addGacha()">ï¼‹ æ–°ã—ã„ã‚¬ãƒãƒ£</button>
  </div>
</div>

<script>
/* ===== ã‚¿ãƒ– ===== */
function showTab(id){
  document.querySelectorAll(".tab-content").forEach(el=>el.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}
document.getElementById("tab-play").onclick=()=>showTab("play");

/* ===== ç®¡ç†ãƒ‘ã‚¹ ===== */
const ADMIN_PASSWORD="IEIRI_ADMIN_405";
document.getElementById("tab-admin").onclick=()=>{
  const pw=prompt("ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");
  if(pw===ADMIN_PASSWORD) showTab("admin");
  else alert("ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒé•ã„ã¾ã™");
};

/* ===== ãƒ‡ãƒ¼ã‚¿ ===== */
let data=JSON.parse(localStorage.getItem("gachaData"))||{
  current:0,
  gachas:[
    {
      title:"åå‰å·®ã—è¾¼ã¿ã‚¬ãƒãƒ£",
      inputs:2,
      slots:[
        ["{name1}ã¯{name2}ã¨é›¨ã®æ—¥ã«å†ä¼šã™ã‚‹"],
        ["{name1}ãŒçªç„¶å‘Šç™½ã•ã‚Œã‚‹"]
      ],
      count:0
    }
  ]
};
save();

/* ===== è¡¨ç¤º ===== */
function renderPlay(){
  const g=data.gachas[data.current];
  document.getElementById("gacha-title").textContent=g.title;
  document.getElementById("count").textContent=g.count;

  const ui=document.getElementById("user-inputs");
  ui.innerHTML="";
  if(g.inputs>=1) ui.innerHTML+=`<input id="name1" placeholder="åå‰1">`;
  if(g.inputs>=2) ui.innerHTML+=`<input id="name2" placeholder="åå‰2">`;

  const s=document.getElementById("slots");
  s.innerHTML="";
  g.slots.forEach(()=>{
    const d=document.createElement("div");
    d.className="slot";
    d.textContent="â€•";
    s.appendChild(d);
  });
}

function rollGacha(){
  const g=data.gachas[data.current];
  const n1=document.getElementById("name1")?.value||"";
  const n2=document.getElementById("name2")?.value||"";

  document.querySelectorAll(".slot").forEach((el,i)=>{
    let text=g.slots[i][Math.floor(Math.random()*g.slots[i].length)];
    text=text.replaceAll("{name1}",n1).replaceAll("{name2}",n2);
    el.textContent=text;
  });
  g.count++;
  save();
  renderPlay();
}

/* ===== ç®¡ç† ===== */
function renderAdmin(){
  const sel=document.getElementById("gachaSelect");
  sel.innerHTML="";
  data.gachas.forEach((g,i)=>{
    const o=document.createElement("option");
    o.value=i;
    o.textContent=g.title;
    sel.appendChild(o);
  });
  sel.value=data.current;
  loadEditor();
}

function selectGacha(){
  data.current=Number(gachaSelect.value);
  save();
  loadEditor();
  renderPlay();
}

function loadEditor(){
  const g=data.gachas[data.current];
  editTitle.value=g.title;
  inputCount.value=g.inputs;
  slotCount.value=g.slots.length;
  renderSlotEditors();
}

function renderSlotEditors(){
  const g=data.gachas[data.current];
  const c=document.getElementById("slotEditors");
  c.innerHTML="";
  const n=Number(slotCount.value);
  g.slots.length=n;

  for(let i=0;i<n;i++){
    if(!g.slots[i]) g.slots[i]=[];
    c.innerHTML+=`<div>ã‚¹ãƒ­ãƒƒãƒˆ${i+1}</div>`;
    const ta=document.createElement("textarea");
    ta.value=g.slots[i].join("\n");
    ta.oninput=()=>g.slots[i]=ta.value.split("\n").filter(Boolean);
    c.appendChild(ta);
  }
}

function saveGacha(){
  const g=data.gachas[data.current];
  g.title=editTitle.value;
  g.inputs=Number(inputCount.value);
  save();
  renderAdmin();
  renderPlay();
}

function addGacha(){
  data.gachas.push({
    title:"æ–°ã—ã„ã‚¬ãƒãƒ£",
    inputs:0,
    slots:[[]],
    count:0
  });
  data.current=data.gachas.length-1;
  save();
  renderAdmin();
  renderPlay();
}

function save(){
  localStorage.setItem("gachaData",JSON.stringify(data));
}

/* ===== åˆæœŸ ===== */
renderPlay();
renderAdmin();
</script>

</body>
</html>
